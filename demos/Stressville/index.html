<!DOCTYPE html>
<html>
	<head>
		<title>Stressvile - RacoonJS</title>
		<meta charset="UTF-8" />
		<script src="stressville.js"></script>
		<script src="racoon.js"></script>
		<style>
			@font-face {
				font-family: '5x5_pixel';
				src: url('5x5_pixel.ttf');
			}
			
			canvas {
				image-rendering: optimizeSpeed;             // Older versions of FF
				image-rendering: -moz-crisp-edges;          // FF 6.0+
				image-rendering: -webkit-optimize-contrast; // Webkit
															//  (Safari now, Chrome soon)
				image-rendering: -o-crisp-edges;            // OS X & Windows Opera (12.02+)
				image-rendering: optimize-contrast;         // Possible future browsers.
				-ms-interpolation-mode: nearest-neighbor;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<script type="text/javascript">
			(function () {
				var img = new Image();
				img.src = './img/map.png';
				var plar = new Image();
				plar.src = './img/hero.png';
				var gui = new Image();
				gui.src = './img/gui.png';
				var decor = new Image();
				decor.src = './img/decor.png';
				var sky = new Image();
				sky.src = './img/sky.png';
				var pistol = new Image();
				pistol.src = './img/pistol.png';
				
				var Game = new RJ.Game();
				var winSize = null;
				
				Game.init({
					canvas: "canvas",
					size: size(640,480),
					rate: 60
				});
				Game.ctx.webkitImageSmoothingEnabled = false;
				winSize = Game.winSize();
				
				var GUI = new RJ.GameObject({
					name: "GUI",
					pos: vecNull(),
					size: size(640,480),
					enter: function () {
						var Stressbar = new SV.Stressbar({
							name: "Stressbar",
							image: gui,
							pos: vecNull(),
							size: size(92,32),
						});
						
						var Timebar = new SV.Timebar({
							name: "Timebar",
							image: gui,
							pos: vec2(0,448),
							size: size(92,32),
						});
						
						this.addChild(Stressbar);
						this.addChild(Timebar);
					}
				});
				
				var GameScene = new RJ.Scene({
					name: "GameScene",
					enter: function () {
						var level = new SV.Level({
							image: img,
							name: "Level",
						});
						
						var decors = new SV.Decorations({
							image: decor,
						});
						
						var skie = new SV.Sky({
							name: "Sky",
							pos: vec2(1344,64),
							image: sky,
							size: size(128,196),
						});
						
						var player =  new SV.Player({
							name: "Player",
							pos: vec2(288,354),
							anchor: vec2(0.5,1),
							image: plar,
							pistol: pistol,
						});
						decors.player = player;
						
						var blood = new SV.Blood({
							name: "Blood",
							pos: vecNull(),
							size: size(0,0),
						});
						player.blood = blood;
						
						this.addChild(skie);
						this.addChild(level);
						this.addChild(decors);
						this.addChild(blood);
						this.addChild(player);
					},
				});
				
				var MainMenu = new RJ.Scene({
					name: "MenuScene",
					enter: function () {
						var Logo = new RJ.Image({
							name: "logo",
							image: gui,
							size: size(172,32),
							crop: new RJ.Rect(0,16,43,8),
							pos:vec2(320,50),
							anchor: vec2(0.5,0.5),
							enter: function () {
								var text = new RJ.Text({
									name: "Texter",
									text: "VILLE",
									font: "Verdana",
									fontSize: 16,
									fillColor: "#fff",
									anchor: vec2(0.5,0.5),
									pos:vec2(86,40),
								});
								
								this.addChild(text);
							}
						});
						
						var White = new RJ.GameObject ({
							name: "Rectangle",
							pos:vec2(100,240),
							anchor: vec2(0.5,0.5),
							size: size(160,160),
							fillColor: "#000",
							lineWidth: 4,
							render: function (ctx) {
								ctx.drawImage(this.image,40,42,40,40,0,0,160,160);
								ctx.strokeRect(0,0,this.rect.w,this.rect.h);
								
								ctx.drawImage(this.image,100,42,40,40,440,0,160,160);
								ctx.drawImage(this.decor,128,48,16,32,488,-8,64,128);
								ctx.strokeRect(440,0,this.rect.w,this.rect.h);
							}
						});
						White.image = img;
						White.decor = decor;
						
						var AnimatingGuy = new RJ.Image({
							name: "Guy",
							image: plar,
							anchor: vec2(0.5,0.5),
							crop: new RJ.Rect(0,0,14,32),
							pos:vec2(100,240),
							size: size(56,128),
							update: function () {
								this.time ++;
								if (this.time > 30) {
									if (!this.ind) {
										this.ind = 1;
									}
									else {
										this.ind ++;
										
										if (this.ind > 11) {
											this.ind = 0;
										}
									}
									
									this.cropRect.x = 14 * this.ind;
									
									this.time = 0;
								}
							}
						});
						AnimatingGuy.time = 0;
						
						var StartButton = new RJ.Text({
							name: "StartButton",
							text: "START",
							font: "Verdana",
							fontSize: 48,
							fillColor: "#fff",
							anchor: vec2(0.5,0.5),
							pos:size2vec(winSize).div(2),
						});
						
						var Text = new RJ.Text({
							name: "Text",
							text: "Your mission is to relax this stressed dude.\nHe has high chance of suicide. Don't let him find arms.",
							font: "Verdana",
							align: "center",
							fontSize: 16,
							fillColor: "#fff",
							anchor: vec2(0.5,0.5),
							pos:size2vec(winSize).div(2).add(vec2(0,160)),
						});
						
						this.button = StartButton;
						
						this.addChild(StartButton);
						this.addChild(Text);
						this.addChild(White);
						this.addChild(Logo);
						this.addChild(AnimatingGuy);
						this.game.mouseHandler.addHandler(this);
					},
					exit: function () {
						this.game.mouseHandler.removeHandler(this);
					},
					mouseHandler: function (state, vec) {
						if (state == "click" && this.button.rect.containVec(vec)) {
							this.removeFromParent();
							this.game.addChild(GameScene);
							this.game.addChild(GUI);
						}
					},
				});
				
				GameScene.mainMenu = MainMenu;
				GameScene.gui = GUI;
				Game.addChild(MainMenu);
				//Game.addChild(GUI);
				//Game.turnOnDebug();
				//Game.showFPS();
			})();
		</script>
	</body>
</html>